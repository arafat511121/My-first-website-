<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temp Mail Example</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #emailAddress { background: #eee; padding: 10px; font-weight: bold; }
        #inbox { margin-top: 20px; border: 1px solid #ccc; min-height: 200px; padding: 10px; }
        .message { border-bottom: 1px solid #ddd; padding: 5px; }
        .message:hover { background: #f9f9f9; }
    </style>
</head>
<body>

    <h2>আমার টেম্প মেইল</h2>
    
    <button id="genBtn">নতুন ইমেইল তৈরি করুন</button>
    <hr>
    
    <h3>আপনার অস্থায়ী ইমেইল ঠিকানা:</h3>
    <div id="emailAddress">...লোড হচ্ছে...</div>
    <button id="checkBtn" style="display:none;">ইনবক্স চেক করুন</button>
    
    <h3>ইনবক্স:</h3>
    <div id="inbox">
        <p>এখানে ইমেইল লিস্ট দেখা যাবে...</p>
    </div>

    <script>
        let currentEmail = null;
        let login = null;
        let domain = null;

        const emailDiv = document.getElementById('emailAddress');
        const inboxDiv = document.getElementById('inbox');
        const genBtn = document.getElementById('genBtn');
        const checkBtn = document.getElementById('checkBtn');

        // ১. একটি নতুন র্যান্ডম ইমেইল জেনারেট করা
        async function generateNewEmail() {
            emailDiv.textContent = '...জেনারেট হচ্ছে...';
            try {
                const response = await fetch('https://www.1secmail.com/api/v1/?action=genRandomMailbox&count=1');
                const data = await response.json();
                
                currentEmail = data[0]; // যেমন: "login@domain.com"
                [login, domain] = currentEmail.split('@'); // ইমেইলকে ভাগ করা
                
                emailDiv.textContent = currentEmail;
                checkBtn.style.display = 'block';
                inboxDiv.innerHTML = '<p>ইনবক্স চেক করতে বাটন চাপুন...</p>';
            } catch (error) {
                emailDiv.textContent = 'ত্রুটি হয়েছে। আবার চেষ্টা করুন।';
                console.error('Error generating email:', error);
            }
        }

        // ২. নির্দিষ্ট ইমেইলের ইনবক্স চেক করা
        async function checkInbox() {
            if (!login || !domain) return;
            
            inboxDiv.innerHTML = '<p>...ইনবক্স লোড হচ্ছে...</p>';
            try {
                const response = await fetch(`https://www.1secmail.com/api/v1/?action=getMessages&login=${login}&domain=${domain}`);
                const data = await response.json();
                
                if (data.length === 0) {
                    inboxDiv.innerHTML = '<p>আপনার ইনবক্সে কোনো মেইল নেই।</p>';
                } else {
                    inboxDiv.innerHTML = ''; // ইনবক্স ক্লিয়ার করা
                    data.forEach(message => {
                        const msgDiv = document.createElement('div');
                        msgDiv.className = 'message';
                        msgDiv.innerHTML = `
                            <strong>From:</strong> ${message.from} <br>
                            <strong>Subject:</strong> ${message.subject} <br>
                            <strong>Date:</strong> ${message.date}
                        `;
                        inboxDiv.appendChild(msgDiv);
                    });
                }
            } catch (error) {
                inboxDiv.innerHTML = '<p>ইনবক্স চেক করতে ত্রুটি হয়েছে।</p>';
                console.error('Error checking inbox:', error);
            }
        }

        // বাটন ইভেন্ট
        genBtn.addEventListener('click', generateNewEmail);
        checkBtn.addEventListener('click', checkInbox);

        // পেজ লোড হলে প্রথমবার একটি ইমেইল জেনারেট করা
        generateNewEmail();

        // প্রতি ১০ সেকেন্ড পর পর অটোমেটিক ইনবক্স চেক করা
        setInterval(checkInbox, 10000); 
    </script>

</body>
</html>
